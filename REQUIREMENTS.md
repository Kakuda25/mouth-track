# 口の動きトラッキングWEBアプリ - 要件定義書

## プロジェクト概要
ノートPC環境で動作する、リアルタイムで口の動きを追跡するWEBアプリケーション。
顔認識技術を使用して、口の特定の8点（外側のみ）をトラッキングする。

## 機能要件

### 1. 顔・口検出機能
- **カメラアクセス**
  - ノートPC内蔵カメラまたは外部USBカメラへのアクセス
  - カメラ権限の取得と管理
  - 複数カメラがある場合の選択機能
  
- **顔検出**
  - リアルタイムでの顔認識
  - 複数人がいる場合の対処（メインの顔を1つ選択）
  - 顔が検出できない場合の警告表示

### 2. 口のランドマークトラッキング
- **トラッキングポイント定義（8点：外側のみ）**
  - 左端（61）
  - 右端（291）
  - 上唇中央外側（13）
  - 下唇中央外側（14）
  - 上唇外側左（37）
  - 上唇外側右（267）
  - 下唇外側左（84）
  - 下唇外側右（314）
  
- **トラッキング精度**
  - 30fps以上での安定したトラッキング
  - ノートPCスペックでも動作する軽量な処理
  - 顔の角度変化（±30度程度）への対応
  - 照明条件の変化への耐性

### 3. 可視化機能
- **リアルタイム表示**
  - カメラ映像のプレビュー表示
  - 8つのトラッキングポイントの視覚的マーキング
    - シアン色: 左端、右端、上唇中央、下唇中央（4点）
    - 黄色: 上唇左右、下唇左右（4点）
  - ポイント間の接続線（10本の線分で菱形を形成）
  - 各ポイントの座標値の表示（オプション）
  
- **表示設定**
  - ポイントの色・サイズのカスタマイズ
  - トラッキング情報の表示/非表示切り替え
  - ミラーモード（左右反転）の有効/無効

### 4. データ出力機能
- **座標データの取得**
  - 8点の2D座標（x, y）のリアルタイム取得
  - 座標の正規化（画面サイズに依存しない相対座標）
  - タイムスタンプ付きデータ
  
- **計測値の算出**
  - 口の開き具合（上下の距離）
  - 口の幅（左右の距離）
  - 口の面積の推定
  - 各値の変化率

### 5. ユーザーインターフェース
- **メイン画面**
  - カメラプレビュー領域（大）
  - コントロールパネル（トラッキング開始/停止、設定）
  - データ表示パネル（リアルタイムの数値）
  
- **設定画面**
  - カメラ選択
  - トラッキング感度の調整
  - 表示設定
  - データエクスポート設定

## 技術要件

### 1. フロントエンド技術
- **必須技術スタック**
  - HTML5（カメラアクセスにMediaStream API使用）
  - CSS3（レスポンシブデザイン）
  - JavaScript（ES6+）
  
- **推奨ライブラリ**
  - TensorFlow.js + MediaPipe FaceMesh
    - または Face-api.js
    - または ML5.js
  - Canvas API（描画処理）

### 2. パフォーマンス要件
- **動作環境**
  - 対象OS: Windows 10/11, macOS, Linux
  - 対象ブラウザ: Chrome/Edge（最新版）, Firefox（最新版）
  - 最低スペック:
    - CPU: Intel Core i5 相当以上
    - RAM: 8GB以上
    - カメラ: 720p解像度以上
  
- **レスポンス要件**
  - カメラ起動: 3秒以内
  - 顔検出: 1秒以内
  - トラッキング遅延: 100ms以内
  - フレームレート: 30fps以上維持

### 3. セキュリティ要件
- **プライバシー保護**
  - カメラ映像はブラウザ内のみで処理（サーバー送信なし）
  - ローカルストレージの適切な使用
  - ユーザーへの明示的な権限要求
  
- **データ管理**
  - 個人を特定できる映像データの保存は最小限に
  - エクスポートデータは座標値のみ（映像含まず）
  - クリアな利用規約とプライバシーポリシー

## 非機能要件

### 1. ユーザビリティ
- 初回起動時のチュートリアル表示
- 直感的なUIデザイン
- エラーメッセージの分かりやすい表示
- 日本語と英語の多言語対応（オプション）

### 2. 互換性
- モダンブラウザでの動作保証
- レスポンシブデザイン（画面サイズへの対応）
- タッチ操作への対応（タブレット利用想定）

### 3. 保守性
- コードの可読性とモジュール化
- 適切なコメントとドキュメント
- バージョン管理（Git）の使用
- テストコードの実装

### 4. 拡張性
- 新しいトラッキングポイントの追加が容易な設計
- プラグインやAPIでの機能拡張が可能
- 他のアプリケーションとの連携機能（WebSocket等）

## 開発フェーズ

### フェーズ1: プロトタイプ（MVP）
- [x] 基本的なカメラアクセス
- [x] 顔検出の実装
- [x] 8点のトラッキング機能
- [x] シンプルな可視化

### フェーズ2: 機能拡張
- [ ] データエクスポート機能
- [ ] 計測値の算出
- [ ] UI/UXの改善
- [ ] 設定画面の実装

### フェーズ3: 最適化
- [ ] パフォーマンスチューニング
- [ ] エラーハンドリングの強化
- [ ] ブラウザ互換性の確保
- [ ] ドキュメント整備

### フェーズ4: 追加機能（オプション）
- [ ] 録画機能
- [ ] リアルタイムグラフ表示
- [ ] 複数の顔の同時トラッキング
- [ ] 3Dビジュアライゼーション

## 技術的課題と対策

### 課題1: パフォーマンス
- **問題**: ノートPCでの処理負荷
- **対策**: 
  - 軽量なMLモデルの選択（MediaPipe推奨）
  - 解像度の動的調整
  - Web Workerでの並列処理
  - 不要な描画処理の削減

### 課題2: トラッキング精度
- **問題**: 照明や角度による精度低下
- **対策**:
  - カルマンフィルタによる座標の平滑化
  - 信頼度スコアの活用
  - 適切な閾値設定

### 課題3: ブラウザ互換性
- **問題**: ブラウザごとのAPI差異
- **対策**:
  - Polyfillの使用
  - 主要ブラウザでの動作テスト
  - フォールバック処理の実装

## 参考技術・ライブラリ

### 推奨: MediaPipe FaceMesh
- Googleが提供する高精度な顔のランドマーク検出
- 468点のランドマーク（口周辺は十分にカバー）
- TensorFlow.jsで実装可能
- リアルタイムでの高速処理

### 代替案1: Face-api.js
- 顔検出、ランドマーク検出、感情認識
- TensorFlow.js基盤
- やや重い処理

### 代替案2: Clmtrackr
- 軽量な顔トラッキングライブラリ
- 精度はMediaPipeより低い
- 古いデバイスでも動作

## 成果物
1. **動作するWEBアプリケーション**
   - index.html
   - CSS/JavaScriptファイル
   - 必要なライブラリ
   
2. **ドキュメント**
   - README.md（セットアップ手順）
   - API仕様書（データ構造）
   - ユーザーマニュアル
   
3. **テストコード**
   - ユニットテスト
   - 統合テスト

## 今後の展開可能性
- リハビリテーション支援（口の動きの訓練）
- 発音分析・言語学習支援
- バーチャルアバターの口パク制御
- 感情分析との組み合わせ
- ゲーム入力デバイスとしての活用

## まとめ
本プロジェクトは、ノートPC環境で動作する実用的な口トラッキングシステムの構築を目指します。
MediaPipeを使用することで、高精度かつ軽量なトラッキングを実現し、
様々なアプリケーションに応用可能な基盤技術として開発します。

